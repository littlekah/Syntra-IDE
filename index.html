<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Syntra 3.0 IDE</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; width: 100%; overflow: hidden; font-family: 'Fira Code', 'Courier New', monospace; }
    body { background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #2d1b4e 100%); color: #e0e0e0; display: flex; flex-direction: column; }
    .header { background: linear-gradient(90deg, rgba(147, 51, 234, 0.4) 0%, rgba(219, 39, 119, 0.4) 100%); backdrop-filter: blur(10px); border-bottom: 2px solid rgba(147, 51, 234, 0.6); padding: 18px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 8px 32px rgba(147, 51, 234, 0.25); flex-wrap: wrap; gap: 15px; }
    .logo { display: flex; align-items: center; gap: 12px; font-size: 26px; font-weight: 900; background: linear-gradient(135deg, #9333ea 0%, #db2777 50%, #7c3aed 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: 2px; }
    .header-buttons { display: flex; gap: 12px; flex-wrap: wrap; }
    .btn { padding: 12px 24px; background: linear-gradient(135deg, #9333ea 0%, #7c3aed 100%); color: white; border: 2px solid rgba(147, 51, 234, 0.5); border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 13px; transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); box-shadow: 0 6px 20px rgba(147, 51, 234, 0.35); text-transform: uppercase; letter-spacing: 1px; }
    .btn:hover { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(147, 51, 234, 0.55); background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%); }
    .btn-secondary { background: linear-gradient(135deg, #db2777 0%, #f0a8d8 100%); }
    .btn-secondary:hover { background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); }
    .btn-danger { background: linear-gradient(135deg, #ff6b6b 0%, #ff8787 100%); }
    .btn-danger:hover { background: linear-gradient(135deg, #ff5252 0%, #ff6b6b 100%); }
    .main-container { display: flex; flex: 1; gap: 0; overflow: hidden; }
    .editor-section { flex: 1; display: flex; flex-direction: column; background: linear-gradient(180deg, rgba(15, 15, 35, 0.95) 0%, rgba(26, 26, 62, 0.95) 100%); border-right: 2px solid rgba(147, 51, 234, 0.35); }
    .editor-header { background: linear-gradient(90deg, rgba(147, 51, 234, 0.15) 0%, rgba(219, 39, 119, 0.15) 100%); padding: 14px 24px; border-bottom: 2px solid rgba(147, 51, 234, 0.25); display: flex; justify-content: space-between; align-items: center; }
    .editor-title { font-weight: bold; color: #9333ea; font-size: 14px; text-transform: uppercase; letter-spacing: 2px; }
    .editor-wrapper { flex: 1; display: flex; overflow: hidden; }
    #codeEditor { flex: 1; padding: 24px; background: transparent; color: #e0e0e0; border: none; resize: none; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.6; outline: none; overflow: auto; }
    #codeEditor::selection { background: rgba(147, 51, 234, 0.5); }
    .console-section { flex: 0 0 280px; background: linear-gradient(180deg, rgba(15, 15, 35, 0.95) 0%, rgba(26, 26, 62, 0.95) 100%); border-left: 2px solid rgba(147, 51, 234, 0.35); display: flex; flex-direction: column; overflow: hidden; }
    .console-header { background: linear-gradient(90deg, rgba(219, 39, 119, 0.15) 0%, rgba(147, 51, 234, 0.15) 100%); padding: 14px 24px; border-bottom: 2px solid rgba(219, 39, 119, 0.25); font-weight: bold; color: #db2777; font-size: 14px; text-transform: uppercase; letter-spacing: 2px; display: flex; justify-content: space-between; align-items: center; }
    #console { flex: 1; padding: 12px; overflow-y: auto; font-size: 11px; font-family: 'Courier New', monospace; }
    .console-line { padding: 4px 0; border-bottom: 1px solid rgba(147, 51, 234, 0.1); }
    .log { color: #90ee90; }
    .info { color: #87ceeb; }
    .warn { color: #ffeb3b; }
    .error { color: #ff6b6b; }
    .success { color: #51cf66; }
    ::-webkit-scrollbar { width: 10px; }
    ::-webkit-scrollbar-track { background: rgba(147, 51, 234, 0.05); }
    ::-webkit-scrollbar-thumb { background: linear-gradient(135deg, #9333ea, #db2777); border-radius: 5px; }
    .reference-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0); pointer-events: none; transition: background 0.3s ease; z-index: 999; }
    .reference-overlay.active { background: rgba(0, 0, 0, 0.4); pointer-events: auto; }
    .reference-panel { position: fixed; top: 0; right: -500px; width: 500px; height: 100vh; background: linear-gradient(180deg, rgba(15, 15, 35, 0.98), rgba(26, 26, 62, 0.98)); border-left: 2px solid rgba(147, 51, 234, 0.5); padding: 20px; overflow-y: auto; transition: right 0.3s ease; z-index: 1000; display: flex; flex-direction: column; }
    .reference-panel.active { right: 0; }
    .reference-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .reference-title { color: #9333ea; font-weight: bold; text-transform: uppercase; font-size: 16px; }
    .close-btn { background: rgba(147, 51, 234, 0.3); border: 1px solid rgba(147, 51, 234, 0.5); color: #9333ea; cursor: pointer; padding: 8px 12px; border-radius: 6px; font-weight: bold; transition: all 0.3s; }
    .close-btn:hover { background: rgba(147, 51, 234, 0.6); transform: scale(1.1); }
    .reference-content { flex: 1; overflow-y: auto; }
    .reference-group { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid rgba(147, 51, 234, 0.2); }
    .reference-group-title { color: #db2777; font-weight: bold; margin-bottom: 8px; font-size: 12px; }
    .reference-item { font-size: 11px; color: #aaa; margin: 4px 0; padding: 4px 8px; background: rgba(147, 51, 234, 0.05); border-radius: 4px; }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">‚ú® SYNTRA 3.0 IDE - Aninhamento Completo</div>
    <div class="header-buttons">
      <button class="btn btn-secondary" onclick="saveCode()">üíæ Salvar</button>
      <button class="btn" onclick="executeCode()">‚ñ∂Ô∏è Executar</button>
      <button class="btn" onclick="toggleReference()">üìö Refer√™ncia</button>
      <button class="btn" onclick="window.location.href='form.html'">üìã Formul√°rio</button>
      <button class="btn btn-danger" onclick="clearConsole()">üóëÔ∏è Limpar</button>
    </div>
  </div>

  <div class="main-container">
    <div class="editor-section">
      <div class="editor-header">
        <div class="editor-title">üíª Editor Syntra 3.0</div>
      </div>
      <div class="editor-wrapper">
        <textarea id="codeEditor" placeholder="// Exemplo com Aninhamento Completo:
for i to 5 then
  if i > 2 then
    out(i)
  end
end

function saudacao(nome)
  out("Ol√°, " + nome)
end

saudacao(\"Kah\")"></textarea>
      </div>
    </div>

    <div class="console-section">
      <div class="console-header">
        <span>üìä Console</span>
        <button class="btn" style="padding: 6px 12px; font-size: 10px;" onclick="clearConsole()">Limpar</button>
      </div>
      <div id="console"></div>
    </div>
  </div>

  <div class="reference-overlay" id="referenceOverlay" onclick="toggleReference()"></div>
  
  <div class="reference-panel" id="referencePanel">
    <div class="reference-header">
      <div class="reference-title">üìö Refer√™ncia</div>
      <button class="close-btn" onclick="toggleReference()">‚úï</button>
    </div>
    <div class="reference-content">
      <div class="reference-group"><div class="reference-group-title">üì§ SA√çDA</div><div class="reference-item">out("texto")</div><div class="reference-item">out(vari√°vel)</div></div>
      <div class="reference-group"><div class="reference-group-title">üì¶ VARI√ÅVEIS</div><div class="reference-item">var x = 10</div><div class="reference-item">global y = 20</div><div class="reference-item">local z = 30</div><div class="reference-item">var table = {"a", "b"};</div><div class="reference-item">table[0], table[1]</div></div>
      <div class="reference-group"><div class="reference-group-title">üîÑ LOOPS</div><div class="reference-item">for i to 10 then ... end</div><div class="reference-item">while (x > 5) do ... end</div></div>
      <div class="reference-group"><div class="reference-group-title">‚úÖ CONDI√á√ïES</div><div class="reference-item">if (x > 5) then ... end</div><div class="reference-item">if (x > 5) then ... else ... end</div></div>
      <div class="reference-group"><div class="reference-group-title">üîß FUN√á√ïES</div><div class="reference-item">function nome(param) ... end</div><div class="reference-item">return valor</div></div>
      <div class="reference-group"><div class="reference-group-title">üìä MATH</div><div class="reference-item">x + y, x - y, x * y, x / y</div><div class="reference-item">random(1, 100)</div><div class="reference-item">distance(x1, y1, x2, y2)</div></div>
      <div class="reference-group"><div class="reference-group-title">üéÆ OBJETOS</div><div class="reference-item">setPosition(obj, x, y)</div><div class="reference-item">setColor(obj, r, g, b)</div><div class="reference-item">setRotation(obj, deg)</div></div>
      <div class="reference-group"><div class="reference-group-title">üéØ COMPARA√á√ïES</div><div class="reference-item">x > y, x < y, x == y</div><div class="reference-item">x >= y, x <= y, x != y</div></div>
      <div class="reference-group"><div class="reference-group-title">üîó L√ìGICA</div><div class="reference-item">and, or, not</div></div>
    </div>
  </div>

  <script>
    class SyntraInterpreter {
      constructor() {
        this.variables = {};
        this.globalVariables = {};
        this.functions = {};
        this.output = [];
        this.returnValue = null;
        this.shouldReturn = false;
      }

      log(message, type = 'log') {
        addConsoleOutput(message, type);
      }

      execute(code) {
        try {
          this.variables = {};
          this.globalVariables = {};
          this.functions = {};
          this.output = [];
          this.returnValue = null;
          this.shouldReturn = false;

          const tokens = this.tokenize(code);
          this.parseAndExecute(tokens, this.variables);

          if (this.output.length === 0) {
            this.log('‚úì C√≥digo executado com sucesso!', 'success');
          }
        } catch (error) {
          this.log(`‚ùå Erro: ${error.message}`, 'error');
        }
      }

      tokenize(code) {
        const tokens = [];
        const lines = code.split('\n');
        
        for (let line of lines) {
          line = line.trim();
          if (!line || line.startsWith('//')) continue;
          tokens.push(line);
        }
        
        return tokens;
      }

      parseAndExecute(tokens, scope, startIdx = 0, endIdx = null) {
        if (endIdx === null) endIdx = tokens.length;
        
        for (let i = startIdx; i < endIdx; i++) {
          const line = tokens[i];
          if (this.shouldReturn) break;

          if (line.startsWith('//')) continue;

          // TABELAS/ARRAYS (com semicolon obrigat√≥rio)
          if ((line.startsWith('var ') || line.startsWith('local ') || line.startsWith('global ')) && line.includes('{') && line.includes('}')) {
            const tableMatch = line.match(/(?:var|local|global)\s+(\w+)\s*=\s*\{(.*)\};?/);
            if (tableMatch) {
              const varName = tableMatch[1];
              const tableContent = tableMatch[2];
              const tableValues = this.parseTable(tableContent, scope);
              
              if (line.startsWith('global ')) {
                this.globalVariables[varName] = tableValues;
              } else {
                scope[varName] = tableValues;
              }
            }
            continue;
          }

          // VARI√ÅVEIS
          if (line.startsWith('var ') || line.startsWith('local ')) {
            const match = line.match(/(?:var|local)\s+(\w+)\s*=\s*(.*)/);
            if (match) {
              scope[match[1]] = this.evaluate(match[2], scope);
            }
          }
          else if (line.startsWith('global ')) {
            const match = line.match(/global\s+(\w+)\s*=\s*(.*)/);
            if (match) {
              this.globalVariables[match[1]] = this.evaluate(match[2], scope);
            }
          }

          // SA√çDA
          else if (line.startsWith('out(')) {
            const match = line.match(/out\((.*)\)/);
            if (match) {
              const value = this.evaluate(match[1], scope);
              this.log(String(value), 'log');
            }
          }

          // DEFINI√á√ÉO DE FUN√á√ÉO
          else if (line.startsWith('function ')) {
            const match = line.match(/function\s+(\w+)\s*\((.*?)\)/);
            if (match) {
              const funcName = match[1];
              const params = match[2].split(',').map(p => p.trim()).filter(p => p);
              
              i++;
              const funcBody = [];
              let endCount = 1;
              
              while (i < endIdx && endCount > 0) {
                if (tokens[i] === 'end') endCount--;
                if (endCount > 0) funcBody.push(tokens[i]);
                i++;
              }
              i--;
              
              this.functions[funcName] = { params, body: funcBody };
            }
          }

          // CHAMADA DE FUN√á√ÉO
          else if (line.match(/^\w+\s*\(.*\)\s*$/) && !line.startsWith('out(')) {
            const match = line.match(/(\w+)\s*\((.*)\)/);
            if (match && this.functions[match[1]]) {
              const funcName = match[1];
              const args = match[2].split(',').map(a => this.evaluate(a.trim(), scope));
              const func = this.functions[funcName];
              
              const funcScope = { ...scope };
              func.params.forEach((param, idx) => {
                funcScope[param] = args[idx] || null;
              });
              
              this.returnValue = null;
              this.shouldReturn = false;
              this.parseAndExecute(func.body, funcScope);
            }
          }

          // RETURN
          else if (line.startsWith('return ')) {
            const match = line.match(/return\s+(.*)/);
            if (match) {
              this.returnValue = this.evaluate(match[1], scope);
              this.shouldReturn = true;
            }
          }

          // IF/ELSE
          else if (line.startsWith('if (')) {
            const condMatch = line.match(/if\s*\((.*?)\)\s*then/);
            if (condMatch) {
              const condition = this.evaluate(condMatch[1], scope);
              
              i++;
              const ifBlock = [];
              let endCount = 1;
              let elseIdx = -1;
              let tempI = i;
              let tempCount = 1;
              
              while (tempI < endIdx && tempCount > 0) {
                if (tokens[tempI] === 'else' && tempCount === 1) {
                  elseIdx = tempI;
                }
                if (tokens[tempI] === 'end') tempCount--;
                tempI++;
              }
              
              if (condition) {
                while (i < endIdx && endCount > 0) {
                  if (tokens[i] === 'else' && endCount === 1) break;
                  if (tokens[i] === 'end') endCount--;
                  if (endCount > 0) ifBlock.push(tokens[i]);
                  i++;
                }
                this.parseAndExecute(ifBlock, scope);
              } else if (elseIdx !== -1) {
                i = elseIdx + 1;
                const elseBlock = [];
                endCount = 1;
                while (i < endIdx && endCount > 0) {
                  if (tokens[i] === 'end') endCount--;
                  if (endCount > 0) elseBlock.push(tokens[i]);
                  i++;
                }
                this.parseAndExecute(elseBlock, scope);
              } else {
                endCount = 1;
                while (i < endIdx && endCount > 0) {
                  if (tokens[i] === 'end') endCount--;
                  i++;
                }
              }
              i--;
            }
          }

          // FOR LOOP
          else if (line.startsWith('for ')) {
            const match = line.match(/for\s+(\w+)\s+to\s+(\d+)\s+then/);
            if (match) {
              const varName = match[1];
              const endVal = parseInt(match[2]);
              
              i++;
              const forBody = [];
              let endCount = 1;
              
              while (i < endIdx && endCount > 0) {
                if (tokens[i] === 'end') endCount--;
                if (endCount > 0) forBody.push(tokens[i]);
                i++;
              }
              
              for (let j = 1; j <= endVal; j++) {
                scope[varName] = j;
                this.parseAndExecute(forBody, scope);
                if (this.shouldReturn) break;
              }
              
              i--;
            }
          }

          // WHILE LOOP
          else if (line.startsWith('while (')) {
            const match = line.match(/while\s*\((.*?)\)\s*do/);
            if (match) {
              const condition = match[1];
              
              i++;
              const whileBody = [];
              let endCount = 1;
              
              while (i < endIdx && endCount > 0) {
                if (tokens[i] === 'end') endCount--;
                if (endCount > 0) whileBody.push(tokens[i]);
                i++;
              }
              
              while (this.evaluate(condition, scope)) {
                this.parseAndExecute(whileBody, scope);
                if (this.shouldReturn) break;
              }
              
              i--;
            }
          }

          // COMANDOS DA ENGINE - OBJETOS
          else if (line.includes('setPosition(')) {
            const match = line.match(/setPosition\((\w+),\s*(\d+),\s*(\d+)\)/);
            if (match) {
              this.log(`üìç setPosition(${match[1]}, ${match[2]}, ${match[3]})`, 'info');
            }
          }
          else if (line.includes('setColor(')) {
            const match = line.match(/setColor\((\w+),\s*(\d+),\s*(\d+),\s*(\d+)\)/);
            if (match) {
              this.log(`üé® setColor(${match[1]}, ${match[2]}, ${match[3]}, ${match[4]})`, 'info');
            }
          }
          else if (line.includes('setRotation(')) {
            const match = line.match(/setRotation\((\w+),\s*(\d+)\)/);
            if (match) {
              this.log(`üîÑ setRotation(${match[1]}, ${match[2]}¬∞)`, 'info');
            }
          }
          else if (line.includes('setScale(')) {
            const match = line.match(/setScale\((\w+),\s*(\d+),\s*(\d+)\)/);
            if (match) {
              this.log(`üìè setScale(${match[1]}, ${match[2]}, ${match[3]})`, 'info');
            }
          }

          // PHYSICS
          else if (line.includes('setVelocity(')) {
            const match = line.match(/setVelocity\((\w+),\s*(-?\d+),\s*(-?\d+)\)/);
            if (match) {
              this.log(`‚ö° setVelocity(${match[1]}, ${match[2]}, ${match[3]})`, 'info');
            }
          }
          else if (line.includes('setGravity(')) {
            const match = line.match(/setGravity\((\w+),\s*([\d.]+)\)/);
            if (match) {
              this.log(`üåç setGravity(${match[1]}, ${match[2]})`, 'info');
            }
          }
          else if (line.includes('applyForce(')) {
            const match = line.match(/applyForce\((\w+),\s*(-?\d+),\s*(-?\d+)\)/);
            if (match) {
              this.log(`üí• applyForce(${match[1]}, ${match[2]}, ${match[3]})`, 'info');
            }
          }
          else if (line.includes('setBounce(')) {
            const match = line.match(/setBounce\((\w+),\s*([\d.]+)\)/);
            if (match) {
              this.log(`üéæ setBounce(${match[1]}, ${match[2]})`, 'info');
            }
          }

          // C√ÇMERA
          else if (line.includes('camera.set(')) {
            const match = line.match(/camera\.set\((-?\d+),\s*(-?\d+)\)/);
            if (match) {
              this.log(`üì∑ camera.set(${match[1]}, ${match[2]})`, 'info');
            }
          }
          else if (line.includes('camera.zoom(')) {
            const match = line.match(/camera\.zoom\(([\d.]+)\)/);
            if (match) {
              this.log(`üîç camera.zoom(${match[1]}x)`, 'info');
            }
          }
          else if (line.includes('camera.follow(')) {
            const match = line.match(/camera\.follow\((\w+)\)/);
            if (match) {
              this.log(`üëÅÔ∏è camera.follow(${match[1]})`, 'info');
            }
          }
          else if (line.includes('camera.shake(')) {
            const match = line.match(/camera\.shake\(([\d.]+),\s*(\d+)\)/);
            if (match) {
              this.log(`üì∫ camera.shake(intensidade: ${match[1]}, tempo: ${match[2]}ms)`, 'info');
            }
          }

          // UI
          else if (line.includes('ui.create(')) {
            const match = line.match(/ui\.create\("(\w+)",\s*"(.*)"\)/);
            if (match) {
              this.log(`üñºÔ∏è ui.create(${match[1]}, "${match[2]}")`, 'info');
            }
          }
          else if (line.includes('ui.setText(')) {
            const match = line.match(/ui\.setText\("(.*)",\s*"(.*)"\)/);
            if (match) {
              this.log(`üìù ui.setText("${match[1]}", "${match[2]}")`, 'info');
            }
          }
          else if (line.includes('ui.setColor(')) {
            const match = line.match(/ui\.setColor\("(.*)",\s*(\d+),\s*(\d+),\s*(\d+)\)/);
            if (match) {
              this.log(`üé® ui.setColor("${match[1]}", ${match[2]}, ${match[3]}, ${match[4]})`, 'info');
            }
          }

          // EXPLORER
          else if (line.includes('FindChild(')) {
            const match = line.match(/(\w+)\s*=\s*FindChild\("(.*)"\)/);
            if (match) {
              scope[match[1]] = { type: 'Object', name: match[2] };
              this.log(`üîç FindChild("${match[2]}") - Encontrado!`, 'info');
            }
          }
          else if (line.includes('FindAllType(')) {
            const match = line.match(/(\w+)\s*=\s*FindAllType\("(.*)"\)/);
            if (match) {
              scope[match[1]] = [{ type: match[2] }, { type: match[2] }];
              this.log(`üîç FindAllType("${match[2]}") - 2 objetos encontrados`, 'info');
            }
          }
          else if (line.includes('exists(')) {
            const match = line.match(/(\w+)\s*=\s*exists\("(.*)"\)/);
            if (match) {
              scope[match[1]] = true;
              this.log(`‚úîÔ∏è exists("${match[2]}") - true`, 'info');
            }
          }
          else if (line.includes('path(')) {
            const match = line.match(/(\w+)\s*=\s*path\("(.*)"\)/);
            if (match) {
              scope[match[1]] = { path: match[2] };
              this.log(`üìÇ path("${match[2]}")`, 'info');
            }
          }

          // ATRIBUI√á√ÉO COM OPERADOR
          else if (line.match(/^\w+\s*[+\-*/]?=\s*.*/)) {
            const match = line.match(/(\w+)\s*=\s*(.*)/);
            if (match) {
              scope[match[1]] = this.evaluate(match[2], scope);
            }
          }
        }
      }

      parseTable(content, scope) {
        const items = [];
        const parts = content.split(',');
        
        for (let part of parts) {
          part = part.trim();
          if (!part) continue;
          items.push(this.evaluate(part, scope));
        }
        
        return items;
      }

      evaluate(expr, scope) {
        expr = expr.trim();

        // TABELAS/ARRAYS
        if (expr.startsWith('{') && expr.endsWith('}')) {
          const tableContent = expr.slice(1, -1);
          return this.parseTable(tableContent, scope);
        }

        // ACESSO A √çNDICES (array[index])
        if (expr.includes('[') && expr.includes(']')) {
          const indexMatch = expr.match(/(\w+)\[(\d+)\]/);
          if (indexMatch) {
            const varName = indexMatch[1];
            const index = parseInt(indexMatch[2]);
            const variable = scope[varName] || this.globalVariables[varName];
            if (Array.isArray(variable) && index >= 0 && index < variable.length) {
              return variable[index];
            }
            return null;
          }
        }

        // STRINGS
        if ((expr.startsWith('"') && expr.endsWith('"')) || (expr.startsWith("'") && expr.endsWith("'"))) {
          return expr.slice(1, -1);
        }

        // N√öMEROS
        if (!isNaN(expr) && expr !== '') return Number(expr);

        // BOOLEANOS
        if (expr === 'true') return true;
        if (expr === 'false') return false;

        // VARI√ÅVEIS
        if (scope[expr]) return scope[expr];
        if (this.globalVariables[expr]) return this.globalVariables[expr];

        // OPERA√á√ïES MATEM√ÅTICAS
        if (expr.includes('+') || expr.includes('-') || expr.includes('*') || expr.includes('/')) {
          return this.evaluateMath(expr, scope);
        }

        // COMPARA√á√ïES
        if (expr.includes('>=') || expr.includes('<=') || expr.includes('==') || expr.includes('!=') || expr.includes('>') || expr.includes('<')) {
          return this.evaluateComparison(expr, scope);
        }

        // FUN√á√ïES BUILT-IN
        if (expr.includes('random(')) {
          const match = expr.match(/random\((\d+),\s*(\d+)\)/);
          if (match) {
            const min = parseInt(match[1]);
            const max = parseInt(match[2]);
            return Math.floor(Math.random() * (max - min + 1)) + min;
          }
        }

        if (expr.includes('distance(')) {
          const match = expr.match(/distance\((-?\d+),\s*(-?\d+),\s*(-?\d+),\s*(-?\d+)\)/);
          if (match) {
            const x1 = parseInt(match[1]), y1 = parseInt(match[2]);
            const x2 = parseInt(match[3]), y2 = parseInt(match[4]);
            return Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
          }
        }

        return expr;
      }

      evaluateMath(expr, scope) {
        let result = expr;
        
        // Replace vari√°veis
        const varMatches = expr.match(/\w+/g) || [];
        for (let varName of varMatches) {
          if (scope[varName] !== undefined) {
            result = result.replace(new RegExp('\\b' + varName + '\\b', 'g'), scope[varName]);
          }
        }

        try {
          return Function('"use strict"; return (' + result + ')')();
        } catch {
          return 0;
        }
      }

      evaluateComparison(expr, scope) {
        let result = expr;
        
        const varMatches = expr.match(/\w+/g) || [];
        for (let varName of varMatches) {
          if (scope[varName] !== undefined) {
            result = result.replace(new RegExp('\\b' + varName + '\\b', 'g'), scope[varName]);
          }
        }

        try {
          return Function('"use strict"; return (' + result + ')')();
        } catch {
          return false;
        }
      }
    }

    let interpreter = new SyntraInterpreter();

    function executeCode() {
      const code = document.getElementById('codeEditor').value;
      clearConsole();
      interpreter.execute(code);
    }

    function addConsoleOutput(message, type) {
      const console = document.getElementById('console');
      const line = document.createElement('div');
      line.className = `console-line ${type}`;
      line.textContent = message;
      console.appendChild(line);
      console.scrollTop = console.scrollHeight;
    }

    function clearConsole() {
      document.getElementById('console').innerHTML = '';
    }

    function saveCode() {
      const code = document.getElementById('codeEditor').value;
      const blob = new Blob([code], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'code.syntra';
      a.click();
    }

    function toggleReference() {
      document.getElementById('referencePanel').classList.toggle('active');
      document.getElementById('referenceOverlay').classList.toggle('active');
    }

    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') executeCode();
    });
  </script>
</body>
</html>
